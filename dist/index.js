!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).tempjs=t()}(this,(function(){"use strict";const e=[{name:"return",description:"Allow user to add variable to the output",delimiter:"=",fn:function(e){return`$__output += escapeHTML(${e})`}},{name:"return HTML",description:"Allow user to add variable to the output with html inside",delimiter:"@",fn:function(e){return`$__output += ${e}`}},{name:"comment",description:"Shortcut to turn some code into a comment",delimiter:"#",fn:function(e){return"/*"+e+"*/"}},{name:"cancel",description:"Output the instruction as text with delimiters",delimiter:"%",fn:function(e,t){return`$__output += escapeHTML("${t.openDelimiter}${e.replace(/"/gi,'\\"')}${t.closeDelimiter}")`}}],t={openDelimiter:"{%",closeDelimiter:"%}",minimified:!0},n="undefined"==typeof window,i=n&&require("fs"),o=n&&require("path");let r="";function u(e,t,u){if(!n)throw new Error("Please use compileFromFileBrowser or includeBrowser instead");(null==u?void 0:u.root)&&(e=o.resolve(u.root,e));const l=i.readFileSync(o.resolve(r,e),"utf-8");return r||(r=o.dirname(e)),g(l,t,u)}function l(e,t){var n;const i=document.location.pathname.split("/");(null===(n=i[i.length-1])||void 0===n?void 0:n.includes("."))&&i.pop();return`${i.join("/")}${(e=e.replace(/^\.?\//g,"/").replace(/\/$/g,""))?"/"+e:""}/${t=t.replace(/^\.?\//g,"").replace(/\/$/g,"")}`}const s="undefined"==typeof window;let c="";async function a(e,t,n){if(s)throw new Error("Please use compileFromFile or include instead");(null==n?void 0:n.root)&&(e=l(n.root,e));const i=await async function(e){return(await fetch(e)).text()}(l(c,e));c||(c=function(e){const t=e.split("/");return 1===t.length?".":(t.pop(),1===t.length&&""===t[0]?"/":t.join("/"))}(e));const o=await g(i,t,n);return c="",o}const d=[{name:"include",description:"Allow to render other file into the template",fn:u},{name:"includeBrowser",description:"Allow to render file into the template from the browser",fn:a},{name:"escapeHTML",description:"Prevent XSS injection from a string",fn:function(e){return"string"!=typeof e?e:e.replace(/[<>&"']/g,(e=>{switch(e){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case"'":return"&#39;";case'"':return"&quot;";default:return e}}))}}],p=async function(){}.constructor;function m(e){return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function f(n,i,o){var r,u,l,s,c,a,f;i=null!=i?i:{},o=null!=o?o:{},(o=Object.assign({},t,o)).delimiters=(null!==(r=o.delimiters)&&void 0!==r?r:[]).concat(e),o.plugins=(null!==(u=o.plugins)&&void 0!==u?u:[]).concat(d);const g=["'use strict'","let $__output=''"],h=new RegExp(String.raw`(\n?[\s\t]*${m(o.openDelimiter)}_?[\s\S]*?_?${m(o.closeDelimiter)}[\s\t]*\n?)`,"gi");for(const e of n.split(h)){if(!h.test(e)){g.push(`$__output += ${JSON.stringify(e)}`);continue}const t=null===(l=e.match(/^\n?[\s\t]*/g))||void 0===l?void 0:l[0],n=null===(s=e.match(/[\s\t]*\n?$/g))||void 0===s?void 0:s[0];let i=e.substring(o.openDelimiter.length+(null!==(c=t.length)&&void 0!==c?c:0),e.length-(o.closeDelimiter.length+(null!==(a=n.length)&&void 0!==a?a:0)));const r=i.startsWith("_"),u=i.endsWith("_");r?i=i.substring(1):g.push(`$__output += ${JSON.stringify(t)}`),u&&(i=i.substring(0,i.length-1));const d=o.delimiters.find((e=>i.startsWith(e.delimiter)));d&&(i=d.fn(i.substring(1),o)),g.push(i),u||g.push(`$__output += ${JSON.stringify(n)}`)}g.push("return $__output");const $=g.join(o.minimified?";":";\n"),w=o.async?p:Function,v=Object.keys(i),_=Object.values(i),y=o.plugins.map((e=>e.name)),b=o.plugins.map((e=>e.fn));return{template:n,data:i,options:o,generatedFunction:w(...v,...y,$).bind(null!==(f=o.context)&&void 0!==f?f:null,..._,...b),generatedCode:$,dataListName:v,dataListValue:_,pluginsName:y,pluginsFunctions:b}}function g(e,t,n){return f(e,t,n).generatedFunction()}return{compile:g,compileFromFile:u,compileFromFileBrowser:a,createFunction:function(e,t,n){return f(e,t,n).generatedFunction},debug:f}}));
//# sourceMappingURL=index.js.map
